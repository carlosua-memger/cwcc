<style type="text/css">
.dropdown-menu > li > .dropdown-menu-item {
   clear: both;
    color: #333;
    display: block;
    padding: 3px 20px;
    white-space: nowrap;
    margin: 5px 0;
    width: 100%;
    text-align: left;
    text-decoration: none;
    outline: none;
    cursor: pointer;
    -moz-user-select: none;
    user-select: none;
}
.dropdown-menu > li:hover .dropdown-menu-item,
.dropdown-menu > li:focus .dropdown-menu-item{
    background-color: #f5f5f5;
    color: #262625;
}
.dropdown-menu > li > .dropdown-menu-item.checkbox {
    margin: 0;
    font-weight: normal;
}
.dropdown-menu > li > .dropdown-menu-item.checkbox input {
    display: none;
}
</style>


<div class="tab-content">
	<div id="tab_0" class="tab-pane active">
		<div class="portlet box grey-cascade">
			<div class="portlet-title">
				<div class="caption">
					<i class="fa fa-gift"></i>Raw Reports
				</div>
				<div class="tools">
					<a class="collapse" href="javascript:;">
					</a>
					<a class="config" data-toggle="modal" href="#portlet-config">
					</a>
					<a class="reload" href="javascript:;">
					</a>
					<a class="remove" href="javascript:;">
					</a>
				</div>
			</div>
			<div class="portlet-body form">
				<!-- BEGIN FORM-->
				<form id="CreateTransaction" class="form-horizontal" target ="_blank">
				<!--action="/inventory/reports/do_print/" method="Get" -->

					<div class="form-body">
							
						<div id="warnerr" class="Metronic-alerts alert alert-warning fade in" hidden>
							date range greater than 16 days	
						</div>

						<div class="form-group">
							<label class="col-md-3 control-label">Report Name:<span class="required" aria-required="true">
								* </span></label>
								<div class="col-md-4">
								<select name="reportname" class="reportname form-control input-xlarge dr-js" required id="reportname">
								<option value="0">Select</option>	
								{{range $assignlist := .RawreportsList }}
								<option  value="{{$assignlist.Sql}}" data-template="{{$assignlist.Template}}">{{$assignlist.Reportname}}</option>
								{{end}}
									</select>
							</div>
						</div>

						<div class="form-group c_datefrom">
							<label class=" col-md-3 control-label">Date: </label>
								<div id="reportrange" class="col-md-4" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 38.5%;  left: 16px;">
										
						<i class="glyphicon glyphicon-calendar fa fa-calendar "></i>
						
						
						<span></span> 
						
						<b class="caret"></b>
						
						                      
					   </div>
					   
					   <span id="limitAlert"class="help-block col-md-4 " style="color:red" hidden >Error: Date range maximum of 31 days </span>	   
							</div>

							<div class="form-group c_asof">
							<label class="col-md-3 control-label">As of
							</label>
							<div class="col-md-8">
								<input type="text" name="asof" id="asof" placeholder="Select Date" class="form-control date-picker-notime"
									maxlength="50">	
						
								</div>
							</div>


								<div class="form-group c_member">
									<label class="col-md-3 control-label">Member :<span class="required"
											aria-required="true">*</span></label>
									<div class="col-md-4">
										<input type="text" name="member" placeholder="Search Member" id="member" class="form-control"
											required>
									</div>
								</div>

								<div class="form-group c_group">
									<label class="col-md-3 control-label">Group :</label>
									<div class="col-md-4">
										<select name="group" id="group" class="form-control">
											<option value="0">All</option>	 
											{{range  $key ,$val := .Ls_group}}
											<option value="{{ index  $val 0}}">{{ index  $val 1}}</option>
											{{end}}
										</select>
									</div>
								</div>

								<div class="form-group c_partner">
										<label class="col-md-3 control-label">Partner :</label>
										<div class="col-md-4">
											<select name="partner" id="partner" class="form-control">
												<option value="0">-Unknown- </option>
												{{range  $key ,$val := .Ls_partner}}
												<option value="{{ index  $val 0}}">{{ index  $val 1}}</option>
												{{end}}
											</select>
										</div>
									</div>

									<div class="form-group c_loantype">
											<label class="col-md-3 control-label">Loan Type :</label>
											<div class="col-md-4">
												<select name="loantype" id="loantype" class="form-control">
												
													{{range  $key ,$val := .Ls_loantype}}
													<option value="{{ index  $val 0}}">{{ index  $val 1}}</option>
													{{end}}
												</select>
											</div>
										</div>

										<div class="form-group c_paymode">
												<label class="col-md-3 control-label">Pay mode :</label>
												<div class="col-md-4">
													<select name="paymode" id="paymode" class="form-control">
														<option value="0">All</option>	 
														{{range  $key ,$val := .Ls_paymode}}
														<option value="{{ index  $val 0}}">{{ index  $val 1}}</option>
														{{end}}
													</select>
												</div>
											</div>

											<div class="form-group c_paymode">
													<label class="col-md-3 control-label">Bank :</label>
													<div class="col-md-4">
														<select name="bank" id="bank" class="form-control">
															<option value="0">All</option>	 
															{{range  $key ,$val := .Ls_bank}}
															<option value="{{ index  $val 0}}">{{ index  $val 1}}</option>
															{{end}}
														</select>
													</div>
												</div>

												<div class="form-group c_status">
														<label class="col-md-3 control-label">Status :</label>
														<div class="col-md-4">
															<select name="status" id="status" class="form-control">
																<option value="0">All</option>	 
																<option value="1">Posted</option>	
																<option value="2">For Posting</option>	
																<option value="2">Cancelled</option>	

																
															</select>
														</div>
													</div>

													<div class="form-group c_coor">
															<label class="col-md-3 control-label">SLOA :</label>
															<div class="col-md-4">
																<select name="coor" id="coor" class="form-control">
																	<option value="0">All</option>	 
																	{{range  $key ,$val := .Ls_sloa}}
																	<option value="{{ index  $val 0}}">{{ index  $val 1}}</option>
																	{{end}}
																</select>
															</div>
														</div>

														<div class="form-group c_trantype">
																<label class="col-md-3 control-label">Trantype :</label>
																<div class="col-md-4">
																	<select name="trantype" id="trantype" class="form-control">
																		
																		{{range  $key ,$val := .Ls_trantype}}
																		<option value="{{ index  $val 0}}">{{ index  $val 1}}</option>
																		{{end}}
																	</select>
																</div>
															</div>

															<div class="form-group c_laetype">
																<label class="col-md-3 control-label">Loan Adjustment Type :</label>
																<div class="col-md-4">
																	<select name="laetype" id="laetype" class="form-control">
																		
																		{{range  $key ,$val := .Ls_laetype}}
																		<option value="{{ index  $val 0}}">{{ index  $val 1}}</option>
																		{{end}}
																	</select>
																</div>
															</div>

															<div class="form-group c_aetype">
																<label class="col-md-3 control-label">Adjustment Type :</label>
																<div class="col-md-4">
																	<select name="aetype" id="aetype" class="form-control">
																		
																		{{range  $key ,$val := .Ls_aetype}}
																		<option value="{{ index  $val 0}}">{{ index  $val 1}}</option>
																		{{end}}
																	</select>
																</div>
															</div>

															<div class="form-group c_lptype">
																<label class="col-md-3 control-label">Loan Payment Type :</label>
																<div class="col-md-4">
																	<select name="lptype" id="lptype" class="form-control">
																		
																		{{range  $key ,$val := .Ls_lptype}}
																		<option value="{{ index  $val 0}}">{{ index  $val 1}}</option>
																		{{end}}
																	</select>
																</div>
															</div>


															<div class="form-group c_othdtltype">
																<label class="col-md-3 control-label">Other Disbursement Detail Type :</label>
																<div class="col-md-4">
																	<select name="othdtltype" id="othdtltype" class="form-control">
																		
																		{{range  $key ,$val := .Ls_othdtltype}}
																		<option value="{{ index  $val 0}}">{{ index  $val 1}}</option>
																		{{end}}
																	</select>
																</div>
															</div>

															<div class="form-group c_partregioncoop">
																<label class="col-md-3 control-label">Partner Region Coop :</label>
																<div class="col-md-4">
																	<select name="partregioncoop" id="partregioncoop" class="form-control">
																		
																		{{range  $key ,$val := .Ls_partregioncoop}}
																		<option value="{{ index  $val 0}}">{{ index  $val 1}}</option>
																		{{end}}
																	</select>
																</div>
															</div>

															

			
						<div class="form-group c_filter">
				                    <label class="col-md-3 control-label">Filter</label>
								<div class="col-md-4" >
									<input type="text" name="filter" placeholder="key word" id="filter" class="form-control input-xlarge" maxlength="50" >
								</div>
							</div>

					

						<div class="form-group">
							<label class="col-md-3 control-label">Export type:</label>
							<div class="col-md-4">
								<select name="export_type" class="form-control input-large dr-js"> 
								<option value="print">Print</option>
								<option value="excel">Excel</option>
								<option value="word">Word</option>
								<option value="pdf">PDF</option>	
								</select>
							</div>
						</div>

						<div class="form-actions fluid">
							<div class="col-md-offset-3 col-md-9">
								<!-- <button class="btn btn-circle blue" type="submit">Print</button> -->
								<a onclick="javascript:gen_det();" class="btn blue">Print</a>
							</div>
						</div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">



	/*$('.date-picker').datepicker({
					 rtl: Metronic.isRTL(),
					 orientation: "left",
					 autoclose: true
			 });*/
	//$(".date-picker").datepicker("setDate",currentDate,"option", "dateFormat", "mm-dd-yy");
	/* $(".date-picker").datetimepicker({
					 Format: 'mm-dd-yy hh:mm:ss'
					
			 }).datetimepicker("setDate", currentDate);*/

		var currentDate = new Date();
		$(".date-picker-notime").datepicker({autoclose: true, todayHighlight : true}).datepicker("setDate", currentDate);

		$("[name=partner] , [name=loantype], [name=coor]").select2();
		$('.date-picker').datepicker({"setDate": new Date() ,  autoclose: true });
		$('#limitAlert').hide()
		var soldbyText ="";	
			$('.c_datefrom').hide()
			$('.c_dateto').hide()
			$('.c_member').hide()
			$('.c_group').hide()
			$('.c_partner').hide()

			$('.c_loantype').hide()
			$('.c_paymode').hide()
			$('.c_status').hide()
			$('.c_coor').hide()
			$('.c_trantype').hide()
			$('.c_laetype').hide()	
			$('.c_aetype').hide()	
			$('.c_filter').hide()
			$('.c_asof').hide()
			$('.c_lptype').hide()	
			$('.c_othdtltype').hide()	
			$('.c_partregioncoop').hide()	
		
		

			$(".dr-js").select2();
			$(".clsAssign").on("select2-close", function() { 
				console.log( $('#datefrom').val() + "&dateto="+$('#dateto').val() )
				$.get("/timekeeping/CreateTransactionDetails/ajaxgetmemberbyassigment?assigmentID="+this.value +"&datefrom="+ $('#datefrom').val() + "&dateto="+$('#dateto').val() ,
            		function(data,status){
                   		var ht ='<option value="0">All</option>'
                   		for (var i = 0; i < data.length; i++) { 
						    ht+='<option value="'+data[i].Member_id+'">'+data[i].Name+'</option>'
						}
						$('#member').html(ht);
				        $('#member').select2();	
					}
                );
			})
		$('#drpmember').select2("val","");	


		//SIS_SupRec_Register 1, @@id, @@org, @@location, '@@from','@@to',@@supplier
		$('.reportname').change(function(){
			$('.c_datefrom').hide()
			$('.c_dateto').hide()
			$('.c_member').hide()
			$('.c_group').hide()
			$('.c_partner').hide()

			$('.c_loantype').hide()
			$('.c_paymode').hide()
			$('.c_status').hide()
			$('.c_coor').hide()
			$('.c_trantype').hide()
			$('.c_filter').hide()
			$('.c_laetype').hide()
			$('.c_aetype').hide()
			$('.c_asof').hide()
			$('.c_lptype').hide()	
			$('.c_othdtltype').hide()
			$('.c_partregioncoop').hide()		
		
			

        	console.log($(this).val())
        	
        	if(stringContains($(this).val(),"@@datefrom")) {
        		$('.c_datefrom').show();	         
            }else{
            	$('.c_datefrom').hide();	
            }
            if(stringContains($(this).val(),"@@dateto")) {
        		$('.c_dateto').show();	         
            }else{
            	$('.c_dateto').hide();	
            }
            if(stringContains($(this).val(),"@@member")) {
        		$('.c_member').show();	         
            }else{
            	$('.c_member').hide();	
            }
            if(stringContains($(this).val(),"@@group")) {
        		$('.c_group').show();	         
            }else{
            	$('.c_group').hide();	
            }
            if(stringContains($(this).val(),"@@partner")) {
        		$('.c_partner').show();	         
            }else{
            	$('.c_partner').hide();	
            }
            if(stringContains($(this).val(),"@@loantype")) {
        		$('.c_loantype').show();	         
            }else{
            	$('.c_loantype').hide();	
            }
            if(stringContains($(this).val(),"@@paymode")) {
        		$('.c_paymode').show();	         
            }else{
            	$('.c_paymode').hide();	
            }
            if(stringContains($(this).val(),"@@status")) {
        		$('.c_status').show();	         
            }else{
            	$('.c_status').hide();	
            }
            if(stringContains($(this).val(),"@@filter")) {
        		$('.c_filter').show();	         
            }else{
            	$('.c_filter').hide();	
            }

            if(stringContains($(this).val(),"@@trantype")) {
        		$('.c_trantype').show();	         
            }else{
            	$('.c_trantype').hide();	
            }

            if(stringContains($(this).val(),"@@coor")) {
        		$('.c_coor').show();	         
            }else{
            	$('.c_coor').hide();	
            }

			if(stringContains($(this).val(),"@@laetype")) {
        		$('.c_laetype').show();	         
            }else{
            	$('.c_laetype').hide();	
            }

			if(stringContains($(this).val(),"@@adjtype")) {
        		$('.c_aetype').show();	         
            }else{
            	$('.c_aetype').hide();	
            }

			if(stringContains($(this).val(),"@@asof")) {
        		$('.c_asof').show();	         
            }else{
            	$('.c_asof').hide();	
            }

			if(stringContains($(this).val(),"@@lptype")) {
        		$('.c_lptype').show();	         
            }else{
            	$('.c_lptype').hide();	
            }

			if(stringContains($(this).val(),"@@othdtltype")) {
        		$('.c_othdtltype').show();	         
            }else{
            	$('.c_othdtltype').hide();	
            }

			if(stringContains($(this).val(),"@@partregioncoop")) {
        		$('.c_partregioncoop').show();	         
            }else{
            	$('.c_partregioncoop').hide();	
            }


		


            
            
        });
		
		var member_name
		function repoFormatResult( repo ) {
		    var markup = "<div class='select2-result-repository clearfix'> <div class='select2-result-repository__title'>" + repo.full_name + "</div></div>";

		    return markup;
		}

		function repoFormatSelection( repo ) {
	       member_name = repo.full_name;
		   return repo.full_name;
	    }

		

		$("#member").select2({
		placeholder: "Search for Members",
		minimumInputLength: 3,
		multiple: false,
		allowClear: false,
		ajax: {
			url: "/master/members_search/search/Ajax/SearchNoStatus",

			//url: "/inventory/adjustment_entry/details/Ajax/Ajax_getItem",
			dataType: "json",
			quietMillis: 250,
			data: function (term, page) {
				return {
					// search term
					q: term
				};
			},
			results: function (data, page) {
				// parse the results into the format expected by Select2.
				// since we are using custom formatting functions we do not need to alter the remote JSON data

				return { results: data.items };
			}



		},


		formatResult: repoFormatResult,
		formatSelection: repoFormatSelection,
		// apply css that makes the dropdown taller
		dropdownCssClass: "bigdrop",
		// we do not want to escape markup since we are displaying html in results
		escapeMarkup: function (m) {
			return m;



		}
	});




                $(function() {
                   
                    
                    
                    //var start = moment().subtract(29, 'days');
                    //var end = moment();

                    var start = moment().subtract(1, 'month').startOf('month')
                    var end = moment().subtract(1, 'month').endOf('month')
                    

                    function cb(start, end) {
                        $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
                    }

                    $('#reportrange').daterangepicker({
                        startDate: start,
                        endDate: end,
                        ranges: {
                           'Today': [moment(), moment()],
                           'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                           'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                           'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                           'This Month': [moment().startOf('month'), moment().endOf('month')],
                           'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                        }
                    }, cb);

                    cb(start, end);
                    
                });

                function gen_det() {
                    
                    $('#limitAlert').hide()
					
                    var strt_date = $('#reportrange').data('daterangepicker').startDate.format('YYYY-MM-DD');
				
                    var strt_date_display = $('#reportrange').data('daterangepicker').startDate.format('DDMMMYYYY');
                    var end_date  = $('#reportrange').data('daterangepicker').endDate.format('YYYY-MM-DD');
                    var end_date_display = $('#reportrange').data('daterangepicker').endDate.format('DDMMMYYYY');
                    var df =$('#reportrange').data('daterangepicker').endDate - $('#reportrange').data('daterangepicker').startDate
                    if(df> 2693000000){ //limit 31 days

                     $('#limitAlert').show()
                      return false; 
                        
                    }
                   // console.log(df)
                  //  var itemid = $("#item").select2("val"); 
                   // var itemkey = document.getElementById("key").value;
                    var group = $('[name=group]').val();
                    var group_name= $("#group option:selected").text();
                    var reportname = $('[name=reportname]').val();
                    var report_name= $("[name=reportname] option:selected").text();
                    var export_type = $('[name=export_type]').val();
                    var partner = $('[name=partner]').val();
                    var partner_name= $("#partner option:selected").text();
					
                    //alert(soldby);
                   
                    var loantype = $('[name=loantype]').val();
                    var loantype_name= $("#loantype option:selected").text();
                    var paymode = $('[name=paymode]').val();
                    var paymode_name= $("#paymode option:selected").text();
                    var bank = $('[name=bank]').val();
                    var bank_name= $("#bank option:selected").text();
                    var filter_name= $('[name=filter]').val();
                    var status= $('[name=status]').val();
					var status_name= $("#status option:selected").text();
					var coor= $('[name=coor]').val();
					var coor_name= $("#coor option:selected").text();
					var trantype= $('[name=trantype]').val();
					var trantype_name= $("#trantype option:selected").text();
					var laetype= $('[name=laetype]').val();
					var laetype_name= $("#laetype option:selected").text();
					var template = $("[name=reportname]").select2().find(":selected").data("template");
                    var member= $('[name=member]').val();
					var aetype= $('[name=aetype]').val();
					var aetype_name= $("#aetype option:selected").text();
					var asof =$('[name=asof]').val();
					asof =  asof.replace('/', '-');
					asof = asof.replace('/', '-');
					var lptype= $('[name=lptype]').val();
					var lptype_name= $("#lptype option:selected").text();

					var othdtltype= $('[name=othdtltype]').val();
					var othdtltype_name= $("#othdtltype option:selected").text();
					
					var partregioncoop= $('[name=partregioncoop]').val();
					var partregioncoop_name= $("#partregioncoop option:selected").text();

                    

                    
                    console.log(strt_date)
                    console.log(end_date)

                   
					
					//	document.getElementById("date_from").value = strt_date;
					//	document.getElementById("date_to").value = end_date;

                  // var aj_url ="?datefrom="+strt_date+"&dateto="+end_date
	             //  console.log(aj_url)
	                    


                   // var params = { datefrom:strt_date, dateto:end_date};
					//var str = jQuery.param( params );

                     
           
 
                    
                  var url_to_open = "/report/do_print?datefrom="+strt_date+"&dateto="+end_date+"&reportname="+reportname+"&export_type="+export_type+"&group="+group+"&group_name="+group_name+"&partner="+partner+"&partner_name="+partner_name+"&loantype="+loantype+"&loantype_name="+loantype_name+"&paymode="+paymode+"&paymode_name="+paymode_name+"&bank="+bank+"&bank_name="+bank_name+"&filter_name="+filter_name+"&status="+status+"&status_name="+status_name+"&coor="+coor+"&coor_name="+coor_name+"&trantype="+trantype+"&trantype_name="+trantype_name+"&template="+template+"&report_name=" + report_name + "&member=" + member + "&member_name=" + member_name + "&laetype=" + laetype + "&laetype_name=" + laetype_name + "&aetype=" + aetype + "&aetype_name=" + aetype_name + "&asof=" + asof + "&lptype=" + lptype + "&lptype_name=" + lptype_name + "&othdtltype=" + othdtltype + "&othdtltype_name=" + othdtltype_name + "&partregioncoop=" + partregioncoop + "&partregioncoop_name=" + partregioncoop_name


                /*  item_id=" + itemid + "&datefrom="+strt_date+"&dateto="+end_date+"&item_key="+itemkey+"&location="+location+"&tranchkbox="+tranchkjoin*/
                    console.log(url_to_open)

                    //alert(url_to_open)
                    //return false;    
                    var myWindow = window.open(url_to_open);
                    return false;
                }


                $(function(){
    $( '.dropdown-menu li' ).on( 'click', function( event ) {
        var $checkbox = $(this).find('.checkbox');
        if (!$checkbox.length) {
            return;
        }
        var $input = $checkbox.find('input');
        var $icon = $checkbox.find('span.glyphicon');
        if ($input.is(':checked')) {
            $input.prop('checked',false);
            $icon.removeClass('glyphicon-check').addClass('glyphicon-unchecked')
        } else {
            $input.prop('checked',true);
            $icon.removeClass('glyphicon-unchecked').addClass('glyphicon-check')
        }
        return false;
    }); 
});



               
               		
                </script>
